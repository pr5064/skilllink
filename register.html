<!-- Keep your design and styles the same -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabase = supabase.createClient(
    'https://sjjxyilbwudaegowxyrk.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNqanh5aWxid3VkYWVnb3d4eXJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM0MzkxODIsImV4cCI6MjA1OTAxNTE4Mn0.3woDyWJoUJXXI466XrhME_qPYqQgSH6FZIjHj0ePP8g'
  );

  document.getElementById('register-form').addEventListener('submit', async function (e) {
    e.preventDefault();

    const fullname = e.target.fullname.value.trim();
    const email = e.target.email.value.trim();
    const password = e.target.password.value;

    // Step 1: Check if user already exists
    const { data: existingUser, error: fetchError } = await supabase
      .from('profiles')
      .select('*')
      .eq('email', email)
      .single();

    if (existingUser) {
      alert('You are already registered with this email!');
      return;
    }

    // Step 2: Sign up with Supabase Auth
    const { data, error } = await supabase.auth.signUp({
      email,
      password
    });

    if (error) {
      alert('Registration Error: ' + error.message);
      return;
    }

    const user = data.user;
    if (user) {
      // Step 3: Store Fullname and Email in 'profiles' table
      await supabase.from('profiles').insert([
        {
          id: user.id,
          full_name: fullname,
          email: email // Add this to check later
        }
      ]);

      alert('Registered successfully! Please check your email to confirm.');
      window.location.href = 'login.html';
    }
  });
</script>
